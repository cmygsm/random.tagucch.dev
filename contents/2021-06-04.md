---
title: '今日のタブ記事、ページネーション、flatMap、mapの中のswitch-case文'
date: '2021-06-04'
tags: ['TypeScript', 'JavaScript', 'flatMap']
---

## 今日のタブ記事

[フロントエンドエンジニアがスキルアップのために意識する「素振り」の仕方と求められる役割](https://offers.jp/media/sidejob/workstyle/a_1901)

これをいつ開いたのかは覚えてないけど、日付を見ると2020-11-11と書いてあるので比較的最近の部類に入る気もする。

内容を読んでみると、

- フロントエンドは多様化してるし一昔前アプリ全盛だった時代と比べると需要も増えてるよね
- スキルについては全体をやっていくか特化してそこに集中するかというのがあるけど、欲を言えば大枠いい感じにやりつつメインのことをやっておけば、すぐに活用できなくても活かすときが来たときに嬉しいよね
- スキルアップのために素振りしよう
- 試したい技術がある or 解決したい課題がある
- Todoistにメモって、空き時間にチュートリアルなどをやるなどして理解を深め、応用ができそうなことを探して実際にそれをやってみる
- とにかくメモって手を動かす
- こういう素振りから自分の知識になり、さらにそこから仕事の打席に立つということもあるしそうなるといいよね
- 副業もアリ
- パフォチューとWASMがアツいぜ
- 小さなことからチャレンジして日々それを積み重ねることが大事

という感じだろうか。

全体的に分かるし、今自分が実践できてないことが多いのでちょっとずつやっていくぞという気持ちになる。

Todoistというタスク管理ツールの話が出てきたけど、最近の自分は仕事以外のタスク管理みたいなものを全然していなくてグダグダな生活になっているし、仕事でもマークダウンフォーマットのメモ帳に雑に書いている感じなので、一度タスク管理やメモの管理については見直す必要があるなというのを思い出した。

雑にBoost Noteにメモっているだけなので、いい感じのメモツールとタスク管理ツールを探す旅を始めなくてはいけない。タスク管理ツールを探すというタスクは脳内で管理するしかないな。

素振りについても言われたらまあそうだよなという気持ちになり、分かってはいるものの動けていないシリーズの筆頭ということで、もっと時間作って気になるもの試すような土壌を形成していきたい。

## ページネーション

このブログはまだ初めて数日なので投稿数はかなり少ないけど、どんどん数が増えていったときに記事一覧をページネーションしたいなというのを思い出した。

SSGのページネーションってどういう感じになるんだろう……と思っているけど、まあ基本的にはシンプルに使えるReactのページネーションのライブラリを利用してクエリパラメータ渡していい感じにやる、みたいなことができれば充分かなと思っている。メモ置き場なので。

忘れないうちにIssueに書いておきます。

## flatMap

JavaScript書いてると配列の値をfilterしてその結果をmapするみたいなことがちょいちょいあって、まあ愚直にfilterしてmapしたりしてたんだけど、なんかIteratorを2回回すのってパフォーマンス的にもっといい方法ありそう……とか思ってしまう。まあデータ数が莫大にならなければ大丈夫だと思うし、そこよりも気にするところは他にあるというのも分かるんだけれども。できるもんならベストを尽くしたいじゃないですか。

で調べたら以下の記事があった。

[【JS】mapとfilterを両方同時に使いたい時の書き方4通り](https://jsnotice.com/posts/2020-07-19/index.html)

知りたかったことがドンピシャで書いてある記事を見つけて喜んで読んだ。

この記事では filterしてからmap / mapしてからfilter / flatMap / reduce の4通りのやり方がそれぞれ書いてあって、愚直にfilterしてmapするのもまあ普通に分かりやすいしそれはそれでアリだなという気持ちにはなった。分かりやすいというのは大事。

ただIteratorを複数回利用するのはやっぱり気が引けると思って、自分がもともと知っているreduceを使うのもいいかなと思った。が、この記事はreduce酷評していて、理由もまあ分かるという感じだったのでおすすめしているflatMapを使ってみることにした。reduceは理解するまで時間かかったし、理解しても見にくいことに変わりはないのでまあ使いたくない気持ちは分かる(でも型定義ちゃんとしておけばある程度わかりやすくなるし実際便利だと思う)

flatMapを使ってみたところ、「めちゃ便利」という気持ちになり最高だった。

reduceみたいにaccumulatorに何が入っているかを考える必要がないのもそうだけど、「元の配列の要素すべてに対して同じ数の処理をして同じ数の結果を返す」という制約がなく、ひとつの要素に対して二つ以上の値を返したり、もしくは返さない(正確には返さないのではなくから配列を返す)こともできるので、元の配列の要素数という縛りがないのがいいと思った。

空配列を返すのがいわゆる「mapの処理でreturnしない要素」を作ることができるのが良くて、つまりこれがfilterと同等の機能ということ。で、あとは返すものを作り出せばいい(これがmapの機能)

結果としてできる配列の中にある空配列はflatMapの内部で`flat`が呼び出されるので、深さ1の配列になり、空配列という要素は消滅するので結果としてfilterみたいなことができる、という感じの理解をした。

mapの中でif文書いて条件に当てはまらないものは空配列を返せばいいのでは？と思ったけどそれだと`flat`されないからダメだし、何も返さないとそもそもmapが成立しなくなるので、めちゃ便利だと思った。

## mapの中でswitch-caseしたら怒られた

flatMapの話したあとにmapの話かいという感じだけど……

mapは全ての要素に対して処理を施したあとそれを新しい配列の要素として必要とするので必ずreturnしなければいけないんだけど、switch-case文でちょっと怒られたという話。

まず普通にswitch-case文を書いてそれぞれのcaseでreturnをしてハイおしまい、とした。

```javascript
arr.map(hoge => {
  switch (hoge) {
    case 'a':
    case 'b':
    case 'c': {
      return 'abc'
    }
    case 'd':
    case 'e':
    case 'f': {
      return 'def'
    }
  }
})
```

こんな感じ。

これだと「mapは全部return必須だぞ」と怒られた。全部returnしとるやろがいと思ったけど、ちょっと考えて思いついたのは「もしかして全部というのは`default`も含めてですか……？」という考えに至った。

結果としては正解で、

```javascript
arr.map(hoge => {
  switch (hoge) {
    case 'a':
    case 'b':
    case 'c': {
      return 'abc'
    }
    case 'd':
    case 'e':
    case 'f':
    default: {
      return 'def'
    }
  }
})
```

以下のように書いたら通った。

TypeScriptを書いていて、caseにある条件以外の値が入ってこないことが保証されているので、`default`要らんな……と思っていたが必要らしい。

余談だけど、returnする場合はbreak書かなくてもいいんだね(returnの下の行にbreak書いたら「到達不可能だよ」って言われた)

